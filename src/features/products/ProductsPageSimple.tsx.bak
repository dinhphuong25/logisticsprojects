import { useState, useMemo } from 'react'
import { useNavigate } from 'react-router-dom'
import { useQuery } from '@tanstack/react-query'
import { Card, CardContent } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Input } from '@/components/ui/input'
import { QRScanner } from '@/components/ui/qr-scanner'
import { motion } from 'framer-motion'
import { getCurrentSeason } from '@/lib/mekong-delta-config'
import { blockchainService } from '@/lib/blockchain'
import {
  Package,
  Plus,
  Edit,
  Search,
  Clock,
  Grid3x3,
  List,
  Filter,
  X,
  Thermometer,
  AlertCircle,
  RefreshCw,
  Eye,
  Star,
  MapPin,
  Scan,
  Waves,
  Sprout,

  Calendar,
  Shield,
  TrendingUp,
  CheckCircle
} from 'lucide-react'
import { getAllProducts, type Product } from '@/lib/products-data'

// Enhanced product interface for ƒêBSCL agricultural products
interface LocalEnhancedProduct extends Product {
  // Agricultural specific fields
  farm?: {
    name: string
    province: string
    farmer: string
    certifications: string[]
  }
  harvest?: {
    season: string
    date: string
    quantity: number
  }
  blockchain?: {
    verified: boolean
    traceabilityCode: string
    transactionHash?: string
  }
  transportation?: {
    method: string
    route: string[]
    sustainability: number
  }
  qualityGrade?: 'A+' | 'A' | 'B' | 'C'
  marketDemand?: 'high' | 'medium' | 'low'
}

// Mock enhanced agricultural products data
const getMekongDeltaProducts = (): LocalEnhancedProduct[] => {
  const baseProducts = getAllProducts()
  
  const agriculturalProducts: LocalEnhancedProduct[] = [
    {
      id: 'AGR-001',
      name: 'Premium ST25 Rice',
      nameVi: 'G·∫°o ST25 Cao C·∫•p',
      sku: 'ST25-001',
      category: 'Ng≈© c·ªëc ƒêBSCL',
      price: 28500,
      unit: 'kg',
      stockLevel: 50000,
      reorderPoint: 10000,
      tempClass: 'DRY',
      tempRange: '25-30¬∞C',
      shelfLifeDays: 365,
      description: 'G·∫°o ST25 th∆°m ngon, ch·∫•t l∆∞·ª£ng cao t·ª´ S√≥c TrƒÉng',
      image: 'https://images.unsplash.com/photo-1536304993881-ff6e9eefa2a6?w=500',
      origin: 'S√≥c TrƒÉng',
      isPopular: true,
      certifications: ['VietGAP', '3_Sao', 'Organic'],
      weight: 25,
      cubic: 0.025,
      subcategory: 'G·∫°o th∆°m',
      supplier: 'H·ª£p t√°c x√£ Th·∫°nh Ph√∫',
      lastRestocked: '2025-01-15',
      farm: {
        name: 'H·ª£p t√°c x√£ Th·∫°nh Ph√∫',
        province: 'S√≥c TrƒÉng',
        farmer: 'Nguy·ªÖn VƒÉn Minh',
        certifications: ['VietGAP', '3_Sao']
      },
      harvest: {
        season: 'V·ª• ƒê√¥ng Xu√¢n',
        date: '2025-01-15',
        quantity: 50
      },
      blockchain: {
        verified: true,
        traceabilityCode: 'ST25-RICE-2025-001',
        transactionHash: '0x' + Math.random().toString(16).substr(2, 40)
      },
      transportation: {
        method: 'ƒê∆∞·ªùng th·ªßy + ƒê∆∞·ªùng b·ªô',
        route: ['S√≥c TrƒÉng', 'C·∫ßn Th∆°', 'TP.HCM'],
        sustainability: 92
      },
      qualityGrade: 'A+',
      marketDemand: 'high'
    },
    {
      id: 'AGR-002',
      name: 'Cat Chu Mango',
      nameVi: 'Xo√†i C√°t Chu',
      sku: 'MANGO-002',
      category: 'Tr√°i c√¢y ƒêBSCL',
      price: 45000,
      unit: 'kg',
      stockLevel: 15000,
      reorderPoint: 3000,
      tempClass: 'CHILL',
      tempRange: '8-12¬∞C',
      shelfLifeDays: 14,
      description: 'Xo√†i C√°t Chu th∆°m ngon, ch·∫•t l∆∞·ª£ng xu·∫•t kh·∫©u',
      image: 'https://images.unsplash.com/photo-1553279768-865429fa0078?w=500',
      origin: 'ƒê·ªìng Th√°p',
      isPopular: true,
      certifications: ['VietGAP', 'Organic', 'GlobalGAP'],
      weight: 10,
      cubic: 0.015,
      subcategory: 'Tr√°i c√¢y t∆∞∆°i',
      supplier: 'V∆∞·ªùn xo√†i Minh Ch√¢u',
      lastRestocked: '2025-01-14',
      farm: {
        name: 'V∆∞·ªùn xo√†i Minh Ch√¢u',
        province: 'ƒê·ªìng Th√°p',
        farmer: 'L√™ Th·ªã H·ªìng',
        certifications: ['VietGAP', 'Organic']
      },
      harvest: {
        season: 'M√πa kh√¥',
        date: '2025-03-20',
        quantity: 15
      },
      blockchain: {
        verified: true,
        traceabilityCode: 'MANGO-CAT-2025-002'
      },
      transportation: {
        method: 'ƒê∆∞·ªùng b·ªô',
        route: ['ƒê·ªìng Th√°p', 'TP.HCM', 'H√† N·ªôi'],
        sustainability: 88
      },
      qualityGrade: 'A+',
      marketDemand: 'high'
    },
    {
      id: 'AGR-003',
      name: 'Tra Fish Fillet',
      nameVi: 'C√° Tra Phi L√™',
      sku: 'FISH-003',
      category: 'Th·ªßy s·∫£n ƒêBSCL',
      price: 65000,
      unit: 'kg',
      stockLevel: 25000,
      reorderPoint: 5000,
      tempClass: 'FROZEN',
      tempRange: '-18¬∞C',
      shelfLifeDays: 365,
      description: 'C√° tra phi l√™ t∆∞∆°i ngon, ch·∫•t l∆∞·ª£ng xu·∫•t kh·∫©u',
      image: 'https://images.unsplash.com/photo-1544943910-4c1dc44aab44?w=500',
      origin: 'An Giang',
      isPopular: true,
      certifications: ['VietGAP', 'ASC', 'HACCP'],
      weight: 2,
      cubic: 0.003,
      subcategory: 'C√° phi l√™',
      supplier: 'Tr·∫°i nu√¥i Ph√∫ H∆∞ng',
      lastRestocked: '2025-01-13',
      farm: {
        name: 'Tr·∫°i nu√¥i Ph√∫ H∆∞ng',
        province: 'An Giang',
        farmer: 'Tr·∫ßn VƒÉn Th√†nh',
        certifications: ['VietGAP', 'ASC']
      },
      harvest: {
        season: 'M√πa m∆∞a',
        date: '2025-02-10',
        quantity: 25
      },
      blockchain: {
        verified: true,
        traceabilityCode: 'FISH-TRA-2025-003'
      },
      transportation: {
        method: 'Xe l·∫°nh',
        route: ['An Giang', 'TP.HCM', 'C·∫£ng C√°t L√°i'],
        sustainability: 85
      },
      qualityGrade: 'A',
      marketDemand: 'high'
    },
    {
      id: 'AGR-004',
      name: 'Dragon Fruit',
      nameVi: 'Thanh Long Ru·ªôt ƒê·ªè',
      sku: 'DRAGON-004',
      category: 'Tr√°i c√¢y ƒêBSCL',
      price: 35000,
      unit: 'kg',
      stockLevel: 8000,
      reorderPoint: 2000,
      tempClass: 'CHILL',
      tempRange: '10-15¬∞C',
      shelfLifeDays: 21,
      description: 'Thanh long ru·ªôt ƒë·ªè ng·ªçt th∆°m t·ª´ Ti·ªÅn Giang',
      image: 'https://images.unsplash.com/photo-1615485290382-441e4d049cb5?w=500',
      origin: 'Ti·ªÅn Giang',
      isPopular: false,
      certifications: ['VietGAP', 'Organic'],
      weight: 8,
      cubic: 0.012,
      subcategory: 'Tr√°i c√¢y nhi·ªát ƒë·ªõi',
      supplier: 'V∆∞·ªùn Thanh Long Ph√∫c L·ªôc',
      lastRestocked: '2025-01-16',
      farm: {
        name: 'V∆∞·ªùn Thanh Long Ph√∫c L·ªôc',
        province: 'Ti·ªÅn Giang',
        farmer: 'Ph·∫°m VƒÉn Ph√∫c',
        certifications: ['VietGAP']
      },
      harvest: {
        season: 'Quanh nƒÉm',
        date: '2025-11-01',
        quantity: 8
      },
      blockchain: {
        verified: true,
        traceabilityCode: 'DRAGON-TG-2025-004'
      },
      qualityGrade: 'A',
      marketDemand: 'medium'
    },
    {
      id: 'AGR-005',
      name: 'Coconut',
      nameVi: 'D·ª´a Xi√™m Xanh',
      sku: 'COCONUT-005',
      category: 'Tr√°i c√¢y ƒêBSCL',
      price: 15000,
      unit: 'tr√°i',
      stockLevel: 12000,
      reorderPoint: 3000,
      tempClass: 'DRY',
      tempRange: '25-30¬∞C',
      shelfLifeDays: 60,
      description: 'D·ª´a xi√™m xanh t∆∞∆°i m√°t t·ª´ B·∫øn Tre',
      image: 'https://images.unsplash.com/photo-1447933601403-0c6688de566e?w=500',
      origin: 'B·∫øn Tre',
      isPopular: true,
      certifications: ['VietGAP'],
      weight: 1.5,
      cubic: 0.002,
      subcategory: 'D·ª´a t∆∞∆°i',
      supplier: 'V∆∞·ªùn d·ª´a Minh T√¢m',
      lastRestocked: '2025-01-17',
      farm: {
        name: 'V∆∞·ªùn d·ª´a Minh T√¢m',
        province: 'B·∫øn Tre',
        farmer: 'Nguy·ªÖn Minh T√¢m',
        certifications: ['VietGAP']
      },
      harvest: {
        season: 'Quanh nƒÉm',
        date: '2025-10-15',
        quantity: 12
      },
      blockchain: {
        verified: false,
        traceabilityCode: 'COCONUT-BT-2025-005'
      },
      qualityGrade: 'A',
      marketDemand: 'high'
    }
  ]

  return [...agriculturalProducts, ...baseProducts.slice(0, 10)]
}

// Fetch products from enhanced catalog
const fetchProducts = async (): Promise<LocalEnhancedProduct[]> => {
  await new Promise(resolve => setTimeout(resolve, 500))
  return getMekongDeltaProducts()
}

/**
 * Old mock data removed - now using centralized product catalog from @/lib/products-data
 * This ensures consistency across Inbound, Outbound, and Products modules
 * All products are now managed in a single source of truth
 */

export default function ProductsPageSimple() {
  const navigate = useNavigate()
  const [searchTerm, setSearchTerm] = useState('')
  const [selectedCategory, setSelectedCategory] = useState('all')
  const [selectedProvince, setSelectedProvince] = useState('all')
  const [selectedSeason, setSelectedSeason] = useState('all')
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid')
  const [showFilters, setShowFilters] = useState(false)
  const [tempFilter, setTempFilter] = useState<string>('all')
  const [blockchainFilter, setBlockchainFilter] = useState<string>('all')
  const [qualityFilter, setQualityFilter] = useState<string>('all')
  const [isScannerOpen, setIsScannerOpen] = useState(false)

  const { data: products = [], isLoading, refetch } = useQuery<LocalEnhancedProduct[]>({
    queryKey: ['products'],
    queryFn: fetchProducts,
    refetchInterval: 60000,
  })

  const currentSeason = getCurrentSeason()

  // Enhanced filter products with ƒêBSCL specific filters
  const filteredProducts = useMemo(() => {
    return products.filter((product: LocalEnhancedProduct) => {
      const matchesSearch =
        product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        product.nameVi.toLowerCase().includes(searchTerm.toLowerCase()) ||
        product.sku.toLowerCase().includes(searchTerm.toLowerCase()) ||
        product.category.toLowerCase().includes(searchTerm.toLowerCase()) ||
        (product.farm?.name || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
        (product.farm?.farmer || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
        (product.blockchain?.traceabilityCode || '').toLowerCase().includes(searchTerm.toLowerCase())
      
      const matchesCategory = selectedCategory === 'all' || product.category === selectedCategory
      const matchesTemp = tempFilter === 'all' || product.tempClass === tempFilter
      const matchesProvince = selectedProvince === 'all' || (product.farm?.province || product.origin) === selectedProvince
      const matchesSeason = selectedSeason === 'all' || (product.harvest?.season || '').includes(selectedSeason)
      const matchesBlockchain = blockchainFilter === 'all' || 
        (blockchainFilter === 'verified' && product.blockchain?.verified) ||
        (blockchainFilter === 'unverified' && !product.blockchain?.verified)
      const matchesQuality = qualityFilter === 'all' || product.qualityGrade === qualityFilter
      
      return matchesSearch && matchesCategory && matchesTemp && matchesProvince && 
             matchesSeason && matchesBlockchain && matchesQuality
    })
  }, [products, searchTerm, selectedCategory, tempFilter, selectedProvince, selectedSeason, blockchainFilter, qualityFilter])

  // Enhanced calculate stats with ƒêBSCL specific metrics
  const stats = useMemo(() => {
    const categories = [...new Set(products.map((p: LocalEnhancedProduct) => p.category))]
    const lowStock = products.filter((p: LocalEnhancedProduct) => p.stockLevel <= p.reorderPoint).length
    const agriculturalProducts = products.filter((p: LocalEnhancedProduct) => p.category.includes('ƒêBSCL'))
    const blockchainVerified = products.filter((p: LocalEnhancedProduct) => p.blockchain?.verified).length
    const premiumGrade = products.filter((p: LocalEnhancedProduct) => p.qualityGrade === 'A+').length
    const totalValue = products.reduce((sum: number, p: LocalEnhancedProduct) => sum + (p.price * p.stockLevel), 0)
    
    return {
      total: products.length,
      frozen: products.filter((p: LocalEnhancedProduct) => p.tempClass === 'FROZEN').length,
      chilled: products.filter((p: LocalEnhancedProduct) => p.tempClass === 'CHILL').length,
      categories: categories.length,
      lowStock,
      agricultural: agriculturalProducts.length,
      blockchainVerified,
      premiumGrade,
      totalValue,
      avgSustainability: agriculturalProducts.reduce((sum: number, p: LocalEnhancedProduct) => sum + (p.transportation?.sustainability || 0), 0) / agriculturalProducts.length || 0
    }
  }, [products])

  const categories = useMemo(() => [...new Set(products.map((p: LocalEnhancedProduct) => p.category))], [products])
  const provinces = useMemo(() => [...new Set(products.map((p: LocalEnhancedProduct) => p.farm?.province || p.origin).filter(Boolean))], [products])
  const seasons = useMemo(() => [...new Set(products.map((p: LocalEnhancedProduct) => p.harvest?.season).filter(Boolean))] as string[], [products])

  const handleScanResult = async (value: string) => {
    try {
      // Try to verify blockchain first
      const verification = await blockchainService.verifyProduct(value)
      if (verification.verified && verification.product) {
        setSearchTerm(verification.product.name)
      } else {
        setSearchTerm(value)
      }
    } catch {
      setSearchTerm(value)
    }
    setIsScannerOpen(false)
  }



  const getTempClassConfig = (tempClass: string) => {
    const configs = {
      CHILL: {
        label: 'M√°t',
        color: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400',
        icon: '‚ùÑÔ∏è',
        gradient: 'from-blue-400 to-cyan-400',
      },
      FROZEN: {
        label: 'ƒê√¥ng l·∫°nh',
        color: 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400',
        icon: 'üßä',
        gradient: 'from-purple-400 to-pink-400',
      },
      DRY: {
        label: 'Kh√¥',
        color: 'bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400',
        icon: 'üì¶',
        gradient: 'from-orange-400 to-amber-400',
      },
    }
    return configs[tempClass as keyof typeof configs] || configs.DRY
  }

  const getStockStatus = (product: Product) => {
    const percentage = (product.stockLevel / (product.reorderPoint * 3)) * 100
    if (product.stockLevel <= product.reorderPoint) {
      return { label: 'S·∫Øp h·∫øt', color: 'bg-red-500', textColor: 'text-red-600' }
    } else if (percentage <= 50) {
      return { label: 'Th·∫•p', color: 'bg-yellow-500', textColor: 'text-yellow-600' }
    }
    return { label: 'ƒê·ªß', color: 'bg-green-500', textColor: 'text-green-600' }
  }

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto"></div>
          <p className="mt-4 text-gray-600 dark:text-gray-400">ƒêang t·∫£i s·∫£n ph·∫©m...</p>
        </div>
      </div>
    )
  }

  return (
    <div className="space-y-4 md:space-y-6 p-3 md:p-6">
      {isScannerOpen && (
        <QRScanner
          onClose={() => setIsScannerOpen(false)}
          onScan={handleScanResult}
          title="Qu√©t m√£ ƒë·ªÉ t√¨m s·∫£n ph·∫©m"
        />
      )}

      {/* Simple Header */}
      <div className="bg-white rounded-lg shadow border border-gray-200 p-6 mb-6">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold text-gray-900 mb-2">
              Qu·∫£n L√Ω S·∫£n Ph·∫©m N√¥ng Nghi·ªáp ƒêBSCL
            </h1>
            <p className="text-gray-600">
              H·ªá th·ªëng qu·∫£n l√Ω s·∫£n ph·∫©m n√¥ng nghi·ªáp ƒê·ªìng b·∫±ng s√¥ng C·ª≠u Long
            </p>
          </div>
          
          <div className="flex items-center gap-6">
            <div className="text-center">
              <p className="text-2xl font-bold text-emerald-600">{stats.total}</p>
              <p className="text-sm text-gray-500">T·ªïng s·∫£n ph·∫©m</p>
            </div>
            <div className="text-center">
              <p className="text-2xl font-bold text-blue-600">{stats.blockchainVerified}</p>
              <p className="text-sm text-gray-500">Blockchain verified</p>
            </div>
            <div className="text-center">
              <p className="text-2xl font-bold text-orange-600">{stats.lowStock}</p>
              <p className="text-sm text-gray-500">S·∫Øp h·∫øt h√†ng</p>
            </div>
          </div>
        </div>
      </div>

      {/* Simple Search & Filter Bar */}
      <div className="bg-white rounded-lg shadow border border-gray-200 p-4 mb-6">
        <div className="flex flex-col lg:flex-row gap-4">
          {/* Search */}
          <div className="flex-1">
            <div className="relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
              <Input
                placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
                value={searchTerm}
                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearchTerm(e.target.value)}
                className="pl-10 h-10 border-gray-300"
              />
            </div>
          </div>
          
          {/* Category Filter */}
          <div className="flex flex-wrap gap-2">
            {['T·∫•t c·∫£', 'Ng≈© c·ªëc ƒêBSCL', 'Tr√°i c√¢y ƒêBSCL', 'Th·ª±c ph·∫©m ch·∫ø bi·∫øn ƒêBSCL'].map((filter) => (
              <button
                key={filter}
                onClick={() => setSelectedCategory(filter === 'T·∫•t c·∫£' ? 'all' : filter)}
                className={`px-3 py-1.5 rounded text-sm font-medium transition-colors ${
                  (filter === 'T·∫•t c·∫£' && selectedCategory === 'all') || selectedCategory === filter
                    ? 'bg-emerald-500 text-white'
                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                }`}
              >
                {filter}
              </button>
            ))}
          </div>
          
          {/* Simple View Controls */}
          <div className="flex items-center gap-2">
            {/* View Toggle */}
            <div className="flex border border-gray-300 rounded">
              <button
                onClick={() => setViewMode('grid')}
                className={`p-2 ${
                  viewMode === 'grid'
                    ? 'bg-emerald-500 text-white'
                    : 'bg-white text-gray-600 hover:bg-gray-50'
                }`}
              >
                <Grid3x3 className="w-4 h-4" />
              </button>
              <button
                onClick={() => setViewMode('list')}
                className={`p-2 ${
                  viewMode === 'list'
                    ? 'bg-emerald-500 text-white'
                    : 'bg-white text-gray-600 hover:bg-gray-50'
                }`}
              >
                <List className="w-4 h-4" />
              </button>
            </div>
            
            {/* Add Product Button */}
            <Button 
              onClick={() => navigate('/products/create')}
              className="bg-emerald-500 hover:bg-emerald-600 text-white"
            >
              <Plus className="w-4 h-4 mr-2" />
              Th√™m s·∫£n ph·∫©m
            </Button>
          </div>
        </div>
      </div>

      {/* Advanced Search & Filters */}
      <Card className="mb-6">
        <CardContent className="p-6">
          <div className="flex flex-col lg:flex-row gap-4">
            <div className="flex-1 relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" />
              <Input
                placeholder="T√¨m ki·∫øm theo t√™n, SKU, danh m·ª•c..."
                value={searchTerm}
                onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearchTerm(e.target.value)}
                className="pl-11 h-11"
              />
            </div>

            {/* Filter Button */}
            <Button
              variant="outline"
              onClick={() => setShowFilters(!showFilters)}
              className="h-11 px-4"
            >
              <Filter className="w-4 h-4 mr-2" />
              B·ªô l·ªçc
              {(selectedCategory !== 'all' || tempFilter !== 'all') && (
                <Badge variant="destructive" className="ml-2 px-1.5 py-0.5 text-xs">
                  {[
                    selectedCategory !== 'all', 
                    selectedProvince !== 'all', 
                    selectedSeason !== 'all',
                    tempFilter !== 'all',
                    blockchainFilter !== 'all',
                    qualityFilter !== 'all'
                  ].filter(Boolean).length}
                </Badge>
              )}
            </Button>
          </div>

          {/* Enhanced Filter Panel with ƒêBSCL specific filters */}
          {showFilters && (
            <div className="mt-4 pt-4 border-t space-y-4">
              {/* Row 1: Category, Province, Season */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label className="flex text-sm font-medium mb-2 items-center gap-2">
                    <Package className="w-4 h-4" />
                    Danh m·ª•c
                  </label>
                  <select
                    value={selectedCategory}
                    onChange={(e) => setSelectedCategory(e.target.value)}
                    className="w-full h-10 px-3 border rounded-lg bg-white dark:bg-gray-800"
                  >
                    <option value="all">T·∫•t c·∫£ danh m·ª•c</option>
                    {categories.map((cat: string) => (
                      <option key={cat} value={cat}>
                        {cat}
                      </option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="flex text-sm font-medium mb-2 items-center gap-2">
                    <MapPin className="w-4 h-4" />
                    T·ªânh/Xu·∫•t x·ª©
                  </label>
                  <select
                    value={selectedProvince}
                    onChange={(e) => setSelectedProvince(e.target.value)}
                    className="w-full h-10 px-3 border rounded-lg bg-white dark:bg-gray-800"
                  >
                    <option value="all">T·∫•t c·∫£ t·ªânh</option>
                    {provinces.map((province: string) => (
                      <option key={province} value={province}>
                        {province}
                      </option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="flex text-sm font-medium mb-2 items-center gap-2">
                    <Calendar className="w-4 h-4" />
                    M√πa v·ª•
                  </label>
                  <select
                    value={selectedSeason}
                    onChange={(e) => setSelectedSeason(e.target.value)}
                    className="w-full h-10 px-3 border rounded-lg bg-white dark:bg-gray-800"
                  >
                    <option value="all">T·∫•t c·∫£ m√πa</option>
                    {seasons.map((season: string) => (
                      <option key={season} value={season}>
                        {season}
                      </option>
                    ))}
                  </select>
                </div>
              </div>

              {/* Row 2: Temperature, Blockchain, Quality */}
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                  <label className="flex text-sm font-medium mb-2 items-center gap-2">
                    <Thermometer className="w-4 h-4" />
                    Nhi·ªát ƒë·ªô
                  </label>
                  <select
                    value={tempFilter}
                    onChange={(e) => setTempFilter(e.target.value)}
                    className="w-full h-10 px-3 border rounded-lg bg-white dark:bg-gray-800"
                  >
                    <option value="all">T·∫•t c·∫£</option>
                    <option value="FROZEN">üßä ƒê√¥ng l·∫°nh</option>
                    <option value="CHILL">‚ùÑÔ∏è M√°t</option>
                    <option value="DRY">üì¶ Kh√¥</option>
                  </select>
                </div>

                <div>
                  <label className="flex text-sm font-medium mb-2 items-center gap-2">
                    <Shield className="w-4 h-4" />
                    Blockchain
                  </label>
                  <select
                    value={blockchainFilter}
                    onChange={(e) => setBlockchainFilter(e.target.value)}
                    className="w-full h-10 px-3 border rounded-lg bg-white dark:bg-gray-800"
                  >
                    <option value="all">T·∫•t c·∫£</option>
                    <option value="verified">‚úÖ ƒê√£ x√°c th·ª±c</option>
                    <option value="unverified">‚è≥ Ch∆∞a x√°c th·ª±c</option>
                  </select>
                </div>

                <div>
                  <label className="flex text-sm font-medium mb-2 items-center gap-2">
                    <Star className="w-4 h-4" />
                    Ch·∫•t l∆∞·ª£ng
                  </label>
                  <select
                    value={qualityFilter}
                    onChange={(e) => setQualityFilter(e.target.value)}
                    className="w-full h-10 px-3 border rounded-lg bg-white dark:bg-gray-800"
                  >
                    <option value="all">T·∫•t c·∫£</option>
                    <option value="A+">‚≠ê A+ (Cao c·∫•p)</option>
                    <option value="A">üåü A (T·ªët)</option>
                    <option value="B">üìã B (Trung b√¨nh)</option>
                    <option value="C">üìÑ C (C∆° b·∫£n)</option>
                  </select>
                </div>

                <div className="flex items-end">
                  <Button
                    variant="ghost"
                    onClick={() => {
                      setSelectedCategory('all')
                      setSelectedProvince('all')
                      setSelectedSeason('all')
                      setTempFilter('all')
                      setBlockchainFilter('all')
                      setQualityFilter('all')
                    }}
                    className="h-10 w-full"
                  >
                    <X className="w-4 h-4 mr-2" />
                    X√≥a b·ªô l·ªçc
                  </Button>
                </div>
              </div>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Simple Products Display */}
      {viewMode === 'grid' ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
          {filteredProducts.map((product: LocalEnhancedProduct) => {
            const tempConfig = getTempClassConfig(product.tempClass)
            const stockStatus = getStockStatus(product)
            
            return (
              <Card key={product.id} className="border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
                {/* Simple Product Image */}
                <div className="relative h-48 bg-gray-100">
                  <img
                    src={product.image}
                    alt={product.nameVi}
                    className="w-full h-full object-cover"
                  />
                  
                  {/* Temperature Badge */}
                  <div className={`absolute top-2 right-2 ${tempConfig.color} text-white px-2 py-1 rounded text-xs font-medium`}>
                    {tempConfig.icon} {tempConfig.label}
                  </div>
                  
                  {/* Popular Badge */}
                  {product.isPopular && (
                    <div className="absolute top-2 left-2 bg-yellow-500 text-white px-2 py-1 rounded text-xs font-medium flex items-center gap-1">
                      <Star className="w-3 h-3 fill-white" />
                      Hot
                    </div>
                  )}
                </div>

                <CardContent className="p-4">
                  {/* Title */}
                  <h3 className="text-lg font-semibold text-gray-900 mb-1 line-clamp-1">
                    {product.nameVi}
                  </h3>
                  <p className="text-sm text-gray-600 mb-3 line-clamp-1">{product.name}</p>

                  {/* Price & Basic Info */}
                  <div className="flex items-center justify-between mb-3">
                    <div>
                      <p className="text-xs text-gray-500">Gi√° b√°n</p>
                      <p className="text-xl font-bold text-emerald-600">
                        {(product.price / 1000).toFixed(0)}K
                      </p>
                    </div>
                    <div className="text-right">
                      <p className="text-xs text-gray-500">SKU</p>
                      <p className="text-sm font-mono text-gray-700">
                        {product.sku}
                      </p>
                    </div>
                  </div>

                  {/* Stock Status */}
                  <div className="mb-3">
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-xs text-gray-500">T·ªìn kho</span>
                      <span className={`text-xs font-medium ${stockStatus.textColor}`}>
                        {stockStatus.label}
                      </span>
                    </div>
                    <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
                      <div
                        className={`h-full ${stockStatus.color} transition-all duration-300`}
                        style={{ width: `${Math.min((product.stockLevel / (product.reorderPoint * 3)) * 100, 100)}%` }}
                      />
                    </div>
                    <p className="text-xs text-gray-500 mt-1">
                      {product.stockLevel} {product.unit}
                    </p>
                  </div>

                  {/* Basic Info Grid */}
                  <div className="grid grid-cols-2 gap-2 mb-3 text-xs">
                    <div className="bg-gray-50 rounded p-2">
                      <div className="flex items-center gap-1 mb-1">
                        <Thermometer className="w-3 h-3 text-blue-500" />
                        <span className="text-gray-600">Nhi·ªát ƒë·ªô</span>
                      </div>
                      <p className="font-medium text-gray-900">{product.tempRange}</p>
                    </div>
                    <div className="bg-gray-50 rounded p-2">
                      <div className="flex items-center gap-1 mb-1">
                        <MapPin className="w-3 h-3 text-green-500" />
                        <span className="text-gray-600">Xu·∫•t x·ª©</span>
                      </div>
                      <p className="font-medium text-gray-900">{product.origin}</p>
                    </div>
                  </div>

                  {/* Action Buttons */}
                  <div className="flex gap-2">
                    <Button
                      size="sm"
                      variant="outline"
                      className="flex-1"
                      onClick={() => navigate(`/products/${product.id}`)}
                    >
                      <Eye className="w-4 h-4 mr-1" />
                      Chi ti·∫øt
                    </Button>
                    <Button
                      size="sm"
                      variant="outline"
                      className="px-3"
                    >
                      <Edit className="w-4 h-4" />
                    </Button>
                  </div>
                </CardContent>
              </Card>
            )
          })}
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredProducts.map((product: LocalEnhancedProduct, index) => {
            const tempConfig = getTempClassConfig(product.tempClass)
            const stockStatus = getStockStatus(product)
            
            return (
              <motion.div
                key={product.id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3, delay: index * 0.05 }}
              >
                <Card className="border border-gray-200 dark:border-gray-700 rounded-2xl overflow-hidden hover:shadow-2xl transition-all duration-300 group">
                  {/* Enhanced Product Image with multiple badges */}
                  <div className="relative h-56 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 overflow-hidden">
                    <motion.img
                      src={product.image}
                      alt={product.nameVi}
                      className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                      whileHover={{ scale: 1.1 }}
                    />
                    
                    {/* Temperature Badge - Enhanced */}
                    <motion.div 
                      className={`absolute top-3 right-3 ${tempConfig.color} text-white px-3 py-1.5 rounded-xl text-xs font-bold shadow-lg backdrop-blur-sm`}
                      whileHover={{ scale: 1.1, rotate: 5 }}
                      transition={{ type: "spring", stiffness: 300 }}
                    >
                      <div className="flex items-center gap-1">
                        {tempConfig.icon} {tempConfig.label}
                      </div>
                    </motion.div>
                    
                    {/* Popular/New/Hot Badges */}
                    <div className="absolute top-3 left-3 flex flex-col gap-2">
                      {product.isPopular && (
                        <motion.div 
                          className="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-3 py-1.5 rounded-xl text-xs font-bold flex items-center gap-1 shadow-lg"
                          animate={{ rotate: [0, -5, 5, -5, 0] }}
                          transition={{ duration: 2, repeat: Infinity }}
                        >
                          <Star className="w-3 h-3 fill-white" />
                          üî• Hot
                        </motion.div>
                      )}
                    </div>
                  </div>

                  <CardContent className="p-5 space-y-4">
                    {/* Product Title & Info */}
                    <div>
                      <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-1 line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                        {product.nameVi}
                      </h3>
                      <p className="text-sm text-gray-600 dark:text-gray-400 line-clamp-1 italic">
                        {product.name}
                      </p>
                      <div className="flex items-center gap-2 mt-2">
                        <span className={`px-3 py-1 rounded-full text-xs font-semibold ${tempConfig.color} text-white shadow-sm`}>
                          {product.category}
                        </span>
                        <span className="px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                          SKU: {product.sku}
                        </span>
                      </div>
                    </div>

                    {/* Stock Status with Animation */}
                    <div className="p-3 rounded-xl bg-gradient-to-r from-blue-50/80 to-indigo-50/80 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-100/50 dark:border-blue-700/30">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-medium text-blue-700 dark:text-blue-300">T·ªìn kho</span>
                        <motion.span 
                          className={`text-sm font-bold px-2 py-1 rounded-full ${stockStatus.textColor} ${stockStatus.color}/20`}
                          whileHover={{ scale: 1.05 }}
                        >
                          {stockStatus.label}
                        </motion.span>
                      </div>
                      <div className="h-3 bg-gray-200/50 dark:bg-gray-700/50 rounded-full overflow-hidden mb-2">
                        <motion.div
                          className={`h-full ${stockStatus.color} rounded-full`}
                          initial={{ width: 0 }}
                          animate={{ width: `${Math.min((product.stockLevel / (product.reorderPoint * 3)) * 100, 100)}%` }}
                          transition={{ duration: 1, delay: index * 0.1 }}
                        />
                      </div>
                      <p className="text-xs text-gray-600 dark:text-gray-400">
                        <strong className="font-semibold">{product.stockLevel}</strong> {product.unit} ‚Ä¢ 
                        T√°i ƒë·∫∑t: <strong>{product.reorderPoint}</strong> {product.unit}
                      </p>
                    </div>

                    {/* Enhanced Agricultural Info */}
                    <div className="grid grid-cols-2 gap-3">
                      <motion.div 
                        className="p-3 rounded-xl bg-gradient-to-br from-cyan-50/80 to-blue-50/80 dark:from-cyan-900/20 dark:to-blue-900/20 border border-cyan-100/50 dark:border-cyan-700/30"
                        whileHover={{ scale: 1.05, rotate: 1 }}
                        transition={{ type: "spring", stiffness: 300 }}
                      >
                        <Thermometer className="w-4 h-4 text-cyan-600 dark:text-cyan-400 mb-2" />
                        <p className="text-xs text-cyan-700 dark:text-cyan-300 font-medium mb-1">Nhi·ªát ƒë·ªô</p>
                        <p className="text-sm font-bold text-gray-900 dark:text-white">{product.tempRange}</p>
                      </motion.div>
                      <motion.div 
                        className="p-3 rounded-xl bg-gradient-to-br from-amber-50/80 to-orange-50/80 dark:from-amber-900/20 dark:to-orange-900/20 border border-amber-100/50 dark:border-amber-700/30"
                        whileHover={{ scale: 1.05, rotate: -1 }}
                        transition={{ type: "spring", stiffness: 300 }}
                      >
                        <Clock className="w-4 h-4 text-amber-600 dark:text-amber-400 mb-2" />
                        <p className="text-xs text-amber-700 dark:text-amber-300 font-medium mb-1">HSD</p>
                        <p className="text-sm font-bold text-gray-900 dark:text-white">{product.shelfLifeDays} ng√†y</p>
                      </motion.div>
                    </div>

                    {/* Farm & Blockchain Info - Enhanced products only */}
                    {(product as LocalEnhancedProduct).farm && (
                      <div className="space-y-3 pt-4 border-t border-gray-100/50 dark:border-gray-700/50">
                        {/* Farm Info */}
                        <motion.div 
                          className="p-3 rounded-xl bg-gradient-to-r from-green-50/80 to-emerald-50/80 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-100/50 dark:border-green-700/30"
                          whileHover={{ scale: 1.02 }}
                          transition={{ type: "spring", stiffness: 300 }}
                        >
                          <div className="flex items-center justify-between mb-2">
                            <div className="flex items-center gap-2">
                              <Sprout className="w-4 h-4 text-green-600 dark:text-green-400" />
                              <span className="text-sm font-bold text-green-700 dark:text-green-300">
                                {(product as LocalEnhancedProduct).farm?.name}
                              </span>
                            </div>
                            {(product as LocalEnhancedProduct).qualityGrade && (
                              <Badge 
                                variant="outline" 
                                className={`text-xs px-2 py-1 font-bold ${
                                  (product as LocalEnhancedProduct).qualityGrade === 'A+' 
                                    ? 'border-yellow-400 text-yellow-700 bg-yellow-50 dark:bg-yellow-900/20' 
                                    : 'border-gray-300'
                                }`}
                              >
                                ‚≠ê {(product as LocalEnhancedProduct).qualityGrade}
                              </Badge>
                            )}
                          </div>
                          <p className="text-xs text-green-600 dark:text-green-400 font-medium">
                            üìç {(product as LocalEnhancedProduct).farm?.province} ‚Ä¢ 
                            {(product as LocalEnhancedProduct).harvest?.season && ` üåæ ${(product as LocalEnhancedProduct).harvest?.season}`}
                          </p>
                          <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            üë®‚Äçüåæ {(product as LocalEnhancedProduct).farm?.farmer}
                          </p>
                        </motion.div>

                        {/* Blockchain Status */}
                        {(product as LocalEnhancedProduct).blockchain && (
                          <motion.div 
                            className="p-3 rounded-xl bg-gradient-to-r from-blue-50/80 to-cyan-50/80 dark:from-blue-900/20 dark:to-cyan-900/20 border border-blue-100/50 dark:border-blue-700/30"
                            whileHover={{ scale: 1.02 }}
                            transition={{ type: "spring", stiffness: 300 }}
                          >
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-2">
                                <Shield className="w-4 h-4 text-blue-600 dark:text-blue-400" />
                                <span className="text-sm font-bold text-blue-700 dark:text-blue-300">
                                  Blockchain
                                </span>
                              </div>
                              {(product as LocalEnhancedProduct).blockchain?.verified ? (
                                <div className="flex items-center gap-1">
                                  <CheckCircle className="w-4 h-4 text-green-500" />
                                  <span className="text-xs font-bold text-green-600">Verified</span>
                                </div>
                              ) : (
                                <span className="text-xs font-bold text-orange-500">Pending</span>
                              )}
                            </div>
                          </motion.div>
                        )}
                      </div>
                    )}

                    {/* Certifications */}
                    {product.certifications.length > 0 && (
                      <div className="flex flex-wrap gap-2">
                        {product.certifications.slice(0, 3).map((cert: string) => (
                          <motion.div
                            key={cert}
                            whileHover={{ scale: 1.05 }}
                            transition={{ type: "spring", stiffness: 400 }}
                          >
                            <Badge 
                              variant="outline" 
                              className="text-xs px-3 py-1 font-medium bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-purple-200/50 dark:border-purple-700/30 text-purple-700 dark:text-purple-300"
                            >
                              üèÜ {cert}
                            </Badge>
                          </motion.div>
                        ))}
                      </div>
                    )}

                    {/* Actions */}
                    <div className="flex gap-3 pt-4 border-t border-gray-100/50 dark:border-gray-700/50">
                      <motion.div className="flex-1" whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>
                        <Button
                          size="sm"
                          variant="outline"
                          className="w-full bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 border-emerald-200/50 dark:border-emerald-700/30 text-emerald-700 dark:text-emerald-300 hover:from-emerald-100 hover:to-teal-100 font-medium"
                          onClick={() => navigate(`/products/${product.id}`)}
                        >
                          <Eye className="w-4 h-4 mr-2" />
                          Chi ti·∫øt
                        </Button>
                      </motion.div>
                      <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
                        <Button
                          size="sm"
                          variant="outline"
                          className="px-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200/50 dark:border-blue-700/30 text-blue-700 dark:text-blue-300 hover:from-blue-100 hover:to-indigo-100"
                        >
                          <Edit className="w-4 h-4" />
                        </Button>
                      </motion.div>
                    </div>
                  </div>
                </CardContent>
                </Card>
              </motion.div>
            )
          })}
        </div>
      ) : (
        // List View
        <div className="space-y-3">
          {filteredProducts.map((product: LocalEnhancedProduct, index) => {
            const tempConfig = getTempClassConfig(product.tempClass)
            const stockStatus = getStockStatus(product)

            return (
              <motion.div
                key={product.id}
                variants={{
                  hidden: { opacity: 0, x: -20 },
                  show: { opacity: 1, x: 0 }
                }}
                whileHover={{ scale: 1.01, y: -2 }}
                transition={{ type: "spring", stiffness: 300, damping: 20 }}
              >
                <Card className="border-0 overflow-hidden bg-gradient-to-r from-white/95 to-gray-50/95 dark:from-gray-800/95 dark:to-gray-900/95 backdrop-blur-xl shadow-lg hover:shadow-2xl transition-all duration-500">
                  <CardContent className="p-0">
                    <div className="flex items-stretch">
                      {/* Image Section */}
                      <div className="relative w-40 lg:w-48 flex-shrink-0 overflow-hidden">
                        <div className="absolute inset-0 bg-gradient-to-br from-emerald-100/30 to-teal-100/30 dark:from-emerald-900/30 dark:to-teal-900/30"></div>
                        <img
                          src={product.image}
                          alt={product.nameVi}
                          className="w-full h-full object-cover transition-transform duration-700 hover:scale-110"
                        />
                        
                        {/* Glassmorphism overlays */}
                        <div className="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent"></div>
                        
                        {/* Popular Badge */}
                        {product.isPopular && (
                          <motion.div 
                            className="absolute top-3 left-3 backdrop-blur-md bg-gradient-to-r from-yellow-400/90 to-orange-400/90 text-white px-3 py-1.5 rounded-full text-xs font-bold shadow-lg flex items-center gap-1 border border-yellow-300/30"
                            initial={{ scale: 0, rotate: -10 }}
                            animate={{ scale: 1, rotate: 0 }}
                            transition={{ delay: index * 0.05 + 0.2 }}
                          >
                            <Star className="w-3 h-3 fill-white" />
                            Hot
                          </motion.div>
                        )}
                        
                        {/* Temperature Badge */}
                        <div className="absolute bottom-3 right-3 backdrop-blur-md bg-white/20 dark:bg-black/20 border border-white/30 text-white px-2 py-1 rounded-lg text-xs font-bold">
                          <span className="mr-1">{tempConfig.icon}</span>
                          {tempConfig.label}
                        </div>
                      </div>

                      {/* Content Section */}
                      <div className="flex-1 p-6 relative">
                        {/* Background Gradient */}
                        <div className="absolute inset-0 bg-gradient-to-r from-white/80 to-gray-50/60 dark:from-gray-800/80 dark:to-gray-900/60 backdrop-blur-sm"></div>
                        
                        <div className="relative z-10">
                          {/* Header */}
                          <div className="flex items-start justify-between mb-4">
                            <div className="flex-1">
                              <div className="flex items-center gap-3 mb-2">
                                <h3 className="text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-white dark:to-gray-200 bg-clip-text text-transparent">
                                  {product.nameVi}
                                </h3>
                                <motion.div whileHover={{ scale: 1.1 }}>
                                  <Badge className={`${tempConfig.color} shadow-md`}>
                                    {tempConfig.icon} {tempConfig.label}
                                  </Badge>
                                </motion.div>
                                {product.isPopular && (
                                  <motion.div whileHover={{ scale: 1.1 }}>
                                    <Badge className="bg-gradient-to-r from-yellow-100 to-orange-100 text-yellow-800 border-yellow-200 shadow-md">
                                      <Star className="w-3 h-3 mr-1 fill-yellow-800" />
                                      Popular
                                    </Badge>
                                  </motion.div>
                                )}
                              </div>
                              <p className="text-sm text-gray-600 dark:text-gray-400 mb-1">{product.name}</p>
                              <p className="text-xs text-gray-500 dark:text-gray-500 line-clamp-2">{product.description}</p>
                            </div>
                          </div>

                          {/* Basic Info Grid */}
                          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            {/* Price & SKU */}
                            <motion.div 
                              className="p-4 rounded-xl bg-gradient-to-r from-emerald-50/80 to-teal-50/80 dark:from-emerald-900/20 dark:to-teal-900/20 border border-emerald-100/50 dark:border-emerald-700/30"
                              whileHover={{ scale: 1.02 }}
                            >
                              <p className="text-xs text-emerald-600 dark:text-emerald-400 font-medium mb-1">Gi√° b√°n</p>
                              <p className="text-xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                                {(product.price / 1000).toFixed(0)}K
                              </p>
                              <p className="text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono">
                                SKU: {product.sku}
                              </p>
                            </motion.div>

                            {/* Stock Status */}
                            <motion.div 
                              className="p-4 rounded-xl bg-gradient-to-r from-blue-50/80 to-indigo-50/80 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-100/50 dark:border-blue-700/30"
                              whileHover={{ scale: 1.02 }}
                            >
                              <p className="text-xs text-blue-600 dark:text-blue-400 font-medium mb-1">T·ªìn kho</p>
                              <p className={`text-lg font-bold ${stockStatus.textColor}`}>
                                {product.stockLevel} {product.unit}
                              </p>
                              <div className="h-1.5 bg-gray-200/50 dark:bg-gray-700/50 rounded-full overflow-hidden mt-2">
                                <motion.div
                                  className={`h-full ${stockStatus.color} rounded-full`}
                                  initial={{ width: 0 }}
                                  animate={{ width: `${Math.min((product.stockLevel / (product.reorderPoint * 3)) * 100, 100)}%` }}
                                  transition={{ duration: 1, delay: index * 0.05 }}
                                />
                              </div>
                            </motion.div>

                            {/* Temperature */}
                            <motion.div 
                              className="p-4 rounded-xl bg-gradient-to-r from-cyan-50/80 to-blue-50/80 dark:from-cyan-900/20 dark:to-blue-900/20 border border-cyan-100/50 dark:border-cyan-700/30"
                              whileHover={{ scale: 1.02 }}
                            >
                              <div className="flex items-center gap-2 mb-1">
                                <Thermometer className="w-3 h-3 text-cyan-600 dark:text-cyan-400" />
                                <p className="text-xs text-cyan-600 dark:text-cyan-400 font-medium">Nhi·ªát ƒë·ªô</p>
                              </div>
                              <p className="text-sm font-bold text-gray-900 dark:text-white">{product.tempRange}</p>
                              <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">HSD: {product.shelfLifeDays} ng√†y</p>
                            </motion.div>

                            {/* Category & Origin */}
                            <motion.div 
                              className="p-4 rounded-xl bg-gradient-to-r from-purple-50/80 to-pink-50/80 dark:from-purple-900/20 dark:to-pink-900/20 border border-purple-100/50 dark:border-purple-700/30"
                              whileHover={{ scale: 1.02 }}
                            >
                              <p className="text-xs text-purple-600 dark:text-purple-400 font-medium mb-1">Danh m·ª•c</p>
                              <p className="text-sm font-bold text-gray-900 dark:text-white mb-1">{product.category}</p>
                              <p className="text-xs text-gray-500 dark:text-gray-400">üìç {product.origin}</p>
                            </motion.div>
                          </div>

                          {/* Enhanced Agricultural Info */}
                          {(product as LocalEnhancedProduct).farm && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 pt-4 border-t border-gray-100/50 dark:border-gray-700/50">
                              {/* Farm Info */}
                              <motion.div 
                                className="p-4 rounded-xl bg-gradient-to-r from-green-50/80 to-emerald-50/80 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-100/50 dark:border-green-700/30"
                                whileHover={{ scale: 1.02 }}
                              >
                                <div className="flex items-center gap-2 mb-2">
                                  <Sprout className="w-4 h-4 text-green-600 dark:text-green-400" />
                                  <span className="text-sm font-bold text-green-700 dark:text-green-300">
                                    {(product as LocalEnhancedProduct).farm?.name}
                                  </span>
                                  {(product as LocalEnhancedProduct).qualityGrade && (
                                    <Badge className="bg-yellow-100 text-yellow-800 border-yellow-200">
                                      ‚≠ê {(product as LocalEnhancedProduct).qualityGrade}
                                    </Badge>
                                  )}
                                </div>
                                <p className="text-xs text-green-600 dark:text-green-400 font-medium">
                                  üìç {(product as LocalEnhancedProduct).farm?.province} ‚Ä¢ 
                                  üåæ {(product as LocalEnhancedProduct).harvest?.season || 'N/A'}
                                </p>
                                <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                  üë®‚Äçüåæ {(product as LocalEnhancedProduct).farm?.farmer}
                                </p>
                              </motion.div>

                              {/* Blockchain Info */}
                              {(product as LocalEnhancedProduct).blockchain && (
                                <motion.div 
                                  className="p-4 rounded-xl bg-gradient-to-r from-blue-50/80 to-cyan-50/80 dark:from-blue-900/20 dark:to-cyan-900/20 border border-blue-100/50 dark:border-blue-700/30"
                                  whileHover={{ scale: 1.02 }}
                                >
                                  <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                      <Shield className="w-4 h-4 text-blue-600 dark:text-blue-400" />
                                      <span className="text-sm font-bold text-blue-700 dark:text-blue-300">Blockchain</span>
                                    </div>
                                    {(product as LocalEnhancedProduct).blockchain?.verified ? (
                                      <div className="flex items-center gap-1">
                                        <CheckCircle className="w-4 h-4 text-green-500" />
                                        <span className="text-xs font-bold text-green-600">Verified</span>
                                      </div>
                                    ) : (
                                      <span className="text-xs font-bold text-orange-500">Pending</span>
                                    )}
                                  </div>
                                </motion.div>
                              )}
                            </div>
                          )}

                          {/* Certifications & Actions */}
                          <div className="flex items-center justify-between pt-4 border-t border-gray-100/50 dark:border-gray-700/50">
                            {/* Certifications */}
                            <div className="flex flex-wrap gap-2">
                              {product.certifications.slice(0, 2).map((cert: string) => (
                                <motion.div
                                  key={cert}
                                  whileHover={{ scale: 1.05 }}
                                  transition={{ type: "spring", stiffness: 400 }}
                                >
                                  <Badge 
                                    variant="outline" 
                                    className="text-xs px-3 py-1 font-medium bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-purple-200/50 dark:border-purple-700/30 text-purple-700 dark:text-purple-300"
                                  >
                                    üèÜ {cert}
                                  </Badge>
                                </motion.div>
                              ))}
                            </div>

                            {/* Action Buttons */}
                            <div className="flex gap-3">
                              <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
                                <Button
                                  size="sm"
                                  variant="outline"
                                  className="bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 border-emerald-200/50 dark:border-emerald-700/30 text-emerald-700 dark:text-emerald-300 hover:from-emerald-100 hover:to-teal-100 font-medium"
                                  onClick={() => navigate(`/products/${product.id}`)}
                                >
                                  <Eye className="w-4 h-4 mr-2" />
                                  Chi ti·∫øt
                                </Button>
                              </motion.div>
                              <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
                                <Button
                                  size="sm"
                                  variant="outline"
                                  className="px-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200/50 dark:border-blue-700/30 text-blue-700 dark:text-blue-300 hover:from-blue-100 hover:to-indigo-100"
                                >
                                  <Edit className="w-4 h-4" />
                                </Button>
                              </motion.div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </motion.div>
            )
          })}
        </div>
      )}

      {filteredProducts.length === 0 && (
        <Card className="border-0 shadow-lg">
          <CardContent className="p-12 text-center">
            <Package className="w-16 h-16 mx-auto mb-4 text-gray-400" />
            <p className="text-gray-500 text-lg font-medium">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o</p>
            <p className="text-gray-400 text-sm mt-2">Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm</p>
          </CardContent>
        </Card>
      )}

      {/* Floating Scanner Button */}
      <button
        type="button"
        onClick={() => setIsScannerOpen(true)}
        className="fixed bottom-6 right-6 md:hidden w-14 h-14 rounded-full bg-gradient-to-br from-emerald-600 to-teal-600 shadow-2xl shadow-emerald-500/40 flex items-center justify-center text-white focus:outline-none focus:ring-4 focus:ring-emerald-500/40"
      >
        <Scan className="w-6 h-6" />
      </button>
    </div>
  )
}
